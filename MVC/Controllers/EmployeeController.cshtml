using Microsoft.AspNetCore.Mvc;
using MVC.Models;

namespace MVC.Controllers
{
    [Route("[controller]")]
    public class EmployeeController : Controller
    {
        private readonly GetEmployees _employees;
        private readonly Department _departments;
        private static List<EmployeeModel> _employeeList = new List<EmployeeModel>();

        public EmployeeController()
        {
            _employees = new GetEmployees();

            _departments = new Department();

            if (_employeeList.Count == 0) _employeeList = _employees.GetEmployeeList();


        }
        public IActionResult Index()
        {

            return View(_employeeList);
        }

        [HttpGet("details/{id}")] // url will be /Employee/details/{id}
        public IActionResult Details(int id)
        {
            var employee = _employees.GetEmployeeById(id);
            return View(employee);
        }

        [HttpGet("Add")]
        public IActionResult AddEmployee()
        {
            ViewBag.Departments = _departments.getDSO();
            return View();
        }

        [HttpPost("Add")]
        public IActionResult AddEmployee(EmployeeModel employee)
        {
            if (ModelState.IsValid)
            {
                employee.ID = _employeeList.Any() ? _employeeList.Max(e => e.ID) + 1 : 1;
                _employeeList.Add(employee);
                return Content($"User {employee.Name} added!");
            }
            ViewBag.Departments = _departments.getDSO();
            return View(employee);

        }
    }
}
